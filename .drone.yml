{
   "kind" : "pipeline",
   "name" : "default",
   "steps" : [
      {
         "commands" : [

            "docker run -t debian bash -c cd\u005C /\u005C \u005C&\u005C&\u005C cd\u005C /\u005C \u005C&\u005C&\u005C timeout\u005C 180\u005C echo\u005C bash\u005C \u005C-c\u005C while\u005C\u005C\u005C \u005C\u005C\u005C[\u005C\u005C\u005C \u005C\u005C\u005C!\u005C\u005C\u005C \u005C\u005C\u005C-e\u005C\u005C\u005C \u005C\u005C\u005C$CIRCLE_ARTIFACTS\u005C\u005C\u005C/ss\u005C\u005C\u005C.pid\u005C\u005C\u005C \u005C\u005C\u005C]\u005C\u005C\u005C;\u005C\u005C\u005C do\u005C\u005C\u005C sleep\u005C\u005C\u005C 1\u005C\u005C\u005C;\u005C\u005C\u005C done",


           "while [ true ]; do perl -e warn && echo 123; sleep 1; done &",
           "sleep 30",
           "echo done"
         ],
         "image" : "quay.io/wakaba/droneci-step-base",
         "name" : "build",
         "volumes" : [
            {
               "name" : "dockersock",
               "path" : "/var/run/docker.sock"
            },
            {
               "name" : "dockershareddir",
               "path" : "/var/lib/docker/shareddir"
            }
         ]
      },
      {
         "commands" : [
            "bash -c cd\u005C \u005C\u005C\u005C/app\u005C \u005C&\u005C&\u005C perl\u005C local\u005C/bin\u005C/pmbp\u005C.pl\u005C \u005C-\u005C-install\u005C-commands\u005C docker",
            "cat bar",
            "ls"
         ],
         "depends_on" : [
            "build"
         ],
         "environment" : {
            "CIRCLE_NODE_INDEX" : "0",
            "CIRCLE_NODE_TOTAL" : "1"
         },
         "image" : "quay.io/wakaba/droneci-step-base",
         "name" : "test--test1",
         "volumes" : [
            {
               "name" : "dockersock",
               "path" : "/var/run/docker.sock"
            },
            {
               "name" : "dockershareddir",
               "path" : "/var/lib/docker/shareddir"
            }
         ]
      },
      {
         "commands" : [
            "bash -c cd\u005C \u005C\u005C\u005C/app\u005C \u005C&\u005C&\u005C perl\u005C local\u005C/bin\u005C/pmbp\u005C.pl\u005C \u005C-\u005C-install\u005C-commands\u005C docker",
            "docker version"
         ],
         "depends_on" : [
            "build"
         ],
         "environment" : {
            "CIRCLE_NODE_INDEX" : "0",
            "CIRCLE_NODE_TOTAL" : "1"
         },
         "image" : "quay.io/wakaba/droneci-step-base",
         "name" : "test--test2",
         "volumes" : [
            {
               "name" : "dockersock",
               "path" : "/var/run/docker.sock"
            },
            {
               "name" : "dockershareddir",
               "path" : "/var/lib/docker/shareddir"
            }
         ]
      },
      {
         "commands" : [
            "bash -c cd\u005C \u005C\u005C\u005C/app\u005C \u005C&\u005C&\u005C perl\u005C local\u005C/bin\u005C/pmbp\u005C.pl\u005C \u005C-\u005C-install\u005C-commands\u005C docker",
            "make test"
         ],
         "depends_on" : [
            "build"
         ],
         "environment" : {
            "CIRCLE_NODE_INDEX" : "0",
            "CIRCLE_NODE_TOTAL" : "1"
         },
         "image" : "quay.io/wakaba/droneci-step-base",
         "name" : "test-pmbp",
         "volumes" : [
            {
               "name" : "dockersock",
               "path" : "/var/run/docker.sock"
            },
            {
               "name" : "dockershareddir",
               "path" : "/var/lib/docker/shareddir"
            }
         ]
      },
      {
         "commands" : [
            "bash -c cd\u005C \u005C\u005C\u005C/app\u005C \u005C&\u005C&\u005C perl\u005C local\u005C/bin\u005C/pmbp\u005C.pl\u005C \u005C-\u005C-install\u005C-commands\u005C docker",
            "docker stop `cat /drone/src/local/ciconfig/dockername`",
            "rm -fr `cat /drone/src/local/ciconfig/dockershareddir`"
         ],
         "depends_on" : [
            "build",
            "test--test1",
            "test--test2",
            "test-pmbp"
         ],
         "failure" : "ignore",
         "image" : "quay.io/wakaba/droneci-step-base",
         "name" : "cleanup-nested",
         "volumes" : [
            {
               "name" : "dockersock",
               "path" : "/var/run/docker.sock"
            },
            {
               "name" : "dockershareddir",
               "path" : "/var/lib/docker/shareddir"
            }
         ],
         "when" : {
            "status" : [
               "failure",
               "success"
            ]
         }
      }
   ],
   "type" : "docker",
   "volumes" : [
      {
         "host" : {
            "path" : "/var/run/docker.sock"
         },
         "name" : "dockersock"
      },
      {
         "host" : {
            "path" : "/var/lib/docker/shareddir"
         },
         "name" : "dockershareddir"
      }
   ],
   "workspace" : {
      "path" : "/drone/src"
   }
}
